---
phase: 01-core-ux-fixes
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - frontend/src/components/pdf-viewer/PdfViewer.tsx
  - frontend/src/components/pdf-viewer/ZoomControls.tsx
autonomous: true

must_haves:
  truths:
    - "User can zoom in on the PDF"
    - "User can zoom out on the PDF"
    - "Current zoom level is displayed as a percentage"
    - "Zoom controls do not break existing highlights or popups"
  artifacts:
    - path: "frontend/src/components/pdf-viewer/ZoomControls.tsx"
      provides: "Zoom in/out buttons and percentage display"
      contains: "zoomIn"
    - path: "frontend/src/components/pdf-viewer/PdfViewer.tsx"
      provides: "ZoomControls integrated inside PdfHighlighter context"
      contains: "ZoomControls"
  key_links:
    - from: "frontend/src/components/pdf-viewer/ZoomControls.tsx"
      to: "PDFViewer.currentScale"
      via: "usePdfHighlighterContext().getViewer()"
      pattern: "viewer\\.currentScale"
    - from: "frontend/src/components/pdf-viewer/PdfViewer.tsx"
      to: "frontend/src/components/pdf-viewer/ZoomControls.tsx"
      via: "JSX child inside PdfHighlighter"
      pattern: "<ZoomControls"
---

<objective>
Add PDF zoom in/out controls with zoom level display.

Purpose: Users cannot currently zoom PDFs, making it difficult to read small text or get an overview of a page. Zoom controls with level display provide essential reading control.

Output: New ZoomControls component and PdfViewer integration providing zoom in, zoom out, and percentage display.
</objective>

<execution_context>
@/Users/damifiance/.claude/get-shit-done/workflows/execute-plan.md
@/Users/damifiance/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-ux-fixes/01-RESEARCH.md
@.planning/phases/01-core-ux-fixes/01-01-SUMMARY.md

@frontend/src/components/pdf-viewer/PdfViewer.tsx
@frontend/node_modules/react-pdf-highlighter-extended/dist/esm/contexts/PdfHighlighterContext.d.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ZoomControls component</name>
  <files>
    frontend/src/components/pdf-viewer/ZoomControls.tsx
  </files>
  <action>
Create a new `ZoomControls.tsx` component in the `pdf-viewer` directory.

**Component requirements:**

1. Import `usePdfHighlighterContext` from `react-pdf-highlighter-extended` and `useState`, `useCallback` from React. Import `ZoomIn`, `ZoomOut` from `lucide-react` for icons.

2. Use `usePdfHighlighterContext()` to access `getViewer()` for the PDFViewer instance.

3. State: `const [scale, setScale] = useState(1.0)` for tracking displayed zoom level.

4. Zoom functions:
   - `zoomIn`: Get viewer via `utils.getViewer()`, increment `currentScale` by 0.25 (25% steps for usability), cap at 3.0 (300%). Update local `scale` state.
   - `zoomOut`: Get viewer, decrement `currentScale` by 0.25, floor at 0.5 (50%). Update local `scale` state.
   - `resetZoom`: Set `currentScale` to initial value. Use `viewer.currentScaleValue = 'page-width'` to reset to page-width fit, then read back `viewer.currentScale` to update display.

5. Sync scale on mount and after zoom: After setting `viewer.currentScale`, read it back with a small `setTimeout(() => setScale(viewer.currentScale), 50)` to handle async PDF.js rendering. On mount, use `useEffect` to read initial scale from viewer.

6. UI layout — floating controls in bottom-right of PDF viewport:
```tsx
<div className="absolute bottom-4 right-4 z-50 flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200/60 px-2 py-1.5">
  <button onClick={zoomOut} className="p-1 text-gray-500 hover:text-gray-700 cursor-pointer rounded hover:bg-gray-100 transition-colors disabled:opacity-30 disabled:cursor-default" disabled={scale <= 0.5} title="Zoom out">
    <ZoomOut size={16} />
  </button>
  <button onClick={resetZoom} className="px-2 py-0.5 text-xs font-medium text-gray-600 hover:bg-gray-100 rounded cursor-pointer transition-colors min-w-[3.5rem] text-center" title="Reset zoom">
    {Math.round(scale * 100)}%
  </button>
  <button onClick={zoomIn} className="p-1 text-gray-500 hover:text-gray-700 cursor-pointer rounded hover:bg-gray-100 transition-colors disabled:opacity-30 disabled:cursor-default" disabled={scale >= 3.0} title="Zoom in">
    <ZoomIn size={16} />
  </button>
</div>
```

7. The percentage display doubles as a reset button — clicking the percentage resets to page-width.

8. Use `disabled` attribute on buttons when at min/max zoom to prevent over-zooming.

**IMPORTANT:** This component MUST be rendered inside `PdfHighlighter` children to have access to `usePdfHighlighterContext`. It cannot be placed outside the PdfHighlighter tree.
  </action>
  <verify>
1. File exists: `ls frontend/src/components/pdf-viewer/ZoomControls.tsx`
2. `cd /Users/damifiance/workspace/AI-paper-reader/frontend && npx tsc --noEmit` — no TypeScript errors
3. Grep for `usePdfHighlighterContext` in ZoomControls.tsx — should exist
4. Grep for `currentScale` in ZoomControls.tsx — should exist
  </verify>
  <done>
- ZoomControls component exists with zoom in, zoom out, and reset functionality
- Zoom level displayed as percentage
- Buttons disabled at min/max zoom
- Uses library's PDFViewer API for zoom (not manual CSS transforms)
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ZoomControls into PdfViewer</name>
  <files>
    frontend/src/components/pdf-viewer/PdfViewer.tsx
  </files>
  <action>
**In PdfViewer.tsx:**

1. Import ZoomControls: `import { ZoomControls } from './ZoomControls';`

2. Add ZoomControls as a sibling to HighlightContainer inside the PdfHighlighter children. The PdfHighlighter component renders its children inside the PDF viewport context, so ZoomControls will have access to `usePdfHighlighterContext`.

3. Place it after the HighlightContainer:
```tsx
<PdfHighlighter ...>
  <HighlightContainer ... />
  <ZoomControls />
</PdfHighlighter>
```

4. Ensure the parent `div` of PdfViewer has `relative` positioning (it already has `className="h-full w-full relative"`), so the `absolute` positioned ZoomControls overlay renders correctly within the PDF viewport area.

5. Remove the `pdfScaleValue="page-width"` prop from PdfHighlighter IF it conflicts with dynamic zoom. Test first — if `pdfScaleValue` forces a fixed scale that overrides `currentScale` changes, remove it and let ZoomControls handle the initial scale. If it only sets the initial scale and doesn't interfere with subsequent changes, keep it.

**Testing note:** After integration, verify that zooming does not misalign existing highlights. The library should automatically update highlight positions when `viewer.currentScale` changes. If highlights drift after zoom, the library is not re-rendering correctly — in that case, check if `pdfScaleValue` needs to be removed.
  </action>
  <verify>
1. `cd /Users/damifiance/workspace/AI-paper-reader/frontend && npx tsc --noEmit` — no TypeScript errors
2. Grep for `ZoomControls` in PdfViewer.tsx — should exist as import and JSX
3. Grep for `<ZoomControls` in PdfViewer.tsx — should exist inside PdfHighlighter
  </verify>
  <done>
- ZoomControls rendered inside PdfHighlighter context
- Zoom in/out buttons functional
- Zoom percentage displayed
- Existing highlights and popups remain correctly positioned after zoom
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `cd /Users/damifiance/workspace/AI-paper-reader/frontend && npx tsc --noEmit`
2. ZoomControls.tsx exists and uses `usePdfHighlighterContext`
3. PdfViewer.tsx imports and renders ZoomControls
4. Zoom buttons change viewer.currentScale (not CSS transforms)
5. Zoom percentage updates after each zoom action
</verification>

<success_criteria>
- User can zoom in by clicking + button (increments by 25%)
- User can zoom out by clicking - button (decrements by 25%)
- Current zoom level shown as percentage (e.g., "125%")
- Clicking percentage resets to page-width fit
- Zoom buttons disabled at min (50%) and max (300%)
- Highlights remain aligned with text after zoom
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-ux-fixes/01-03-SUMMARY.md`
</output>
